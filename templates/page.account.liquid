{% comment %} 
    Account page template
{% endcomment %}

{% comment %} Check if customer is logged in {% endcomment %}
{% unless customer %}
  <div class="account-login-required">
    <div class="container">
      <div class="login-prompt">
        <h1>Please Log In</h1>
        <p>You need to be logged in to access your account.</p>
        <a href="/pages/signin" class="btn btn-primary">Sign In</a>
        <a href="/pages/create-account" class="btn btn-secondary">Create Account</a>
      </div>
    </div>
  </div>
{% else %}

<div class="account-page">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">My Account</h1>
      <p class="page-description">Manage your account and orders</p>
    </div>

    <!-- Account Content -->
    <div class="account-content">
      <div class="account-layout">
        <!-- Account Sidebar -->
        <aside class="account-sidebar">
          <nav class="account-nav">
            <a
              href="#profile"
              class="account-nav-link active"
              data-section="profile">Profile</a>
            <a
              href="#orders"
              class="account-nav-link"
              data-section="orders">Orders</a>
            <a
              href="#addresses"
              class="account-nav-link"
              data-section="addresses">Addresses</a>
            <a
              href="#wishlist"
              class="account-nav-link"
              data-section="wishlist">Wishlist</a>
            <a
              href="#settings"
              class="account-nav-link"
              data-section="settings">Settings</a>
          </nav>
        </aside>

        <!-- Account Main Content -->
        <main class="account-main">
          <!-- Profile Section -->
          <div class="account-section active" id="profile-section">
            <h2 class="section-title">Profile Information</h2>
            {% form 'customer' %}
              {% if form.errors %}
                <div class="form-errors">
                  <h4>Please correct the following errors:</h4>
                  <ul>
                    {% for field in form.errors %}
                      <li>{{ field | capitalize }} {{ form.errors.messages[field] }}</li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}

              {% if form.posted_successfully? %}
                <div class="form-success">
                  <p>Your profile has been updated successfully!</p>
                </div>
              {% endif %}

              <div class="profile-form">
                <div class="form-group">
                  <label for="customer_first_name">First Name</label>
                  <input
                    type="text"
                    id="customer_first_name"
                    name="customer[first_name]"
                    value="{{ form.first_name | default: customer.first_name }}"
                    required>
                </div>
                <div class="form-group">
                  <label for="customer_last_name">Last Name</label>
                  <input
                    type="text"
                    id="customer_last_name"
                    name="customer[last_name]"
                    value="{{ form.last_name | default: customer.last_name }}"
                    required>
                </div>
                <div class="form-group">
                  <label for="customer_email">Email</label>
                  <input
                    type="email"
                    id="customer_email"
                    name="customer[email]"
                    value="{{ form.email | default: customer.email }}"
                    required>
                </div>
                <div class="form-group">
                  <label for="customer_phone">Phone</label>
                  <input
                    type="tel"
                    id="customer_phone"
                    name="customer[phone]"
                    value="{{ form.phone | default: customer.phone }}">
                </div>
                <button type="submit" class="btn btn-primary profile-update-btn">Update Profile</button>
              </div>
            {% endform %}
          </div>

          <!-- Orders Section -->
          <div class="account-section" id="orders-section">
            <h2 class="section-title">Order History</h2>
            <div class="orders-list">
              {% if customer.orders.size > 0 %}
                {% for order in customer.orders %}
                  <div class="order-item">
                    <div class="order-info">
                      <div class="order-number">Order #{{ order.order_number }}</div>
                      <div class="order-date">{{ order.created_at | date: "%B %d, %Y" }}</div>
                      <div class="order-status">{{ order.fulfillment_status | default: 'Pending' | capitalize }}</div>
                    </div>
                    <div class="order-total">{{ order.total_price | money }}</div>
                    <div class="order-actions">
                      <a href="{{ order.customer_url }}" class="btn btn-secondary">View Details</a>
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="empty-orders">
                  <p>You haven't placed any orders yet.</p>
                  <a href="/" class="btn btn-primary">Start Shopping</a>
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Addresses Section -->
          <div class="account-section" id="addresses-section">
            <h2 class="section-title">Addresses</h2>
            <div class="addresses-list">
              {% if customer.addresses.size > 0 %}
                {% for address in customer.addresses %}
                  <div class="address-item">
                    <div class="address-info">
                      <h3>
                        {% if address == customer.default_address %}
                          Default Address
                        {% else %}
                          Address {{ forloop.index }}
                        {% endif %}
                      </h3>
                      <p>
                        {{ address.first_name }} {{ address.last_name }}<br>
                        {{ address.address1 }}<br>
                        {% if address.address2 != blank %}{{ address.address2 }}<br>{% endif %}
                        {{ address.city }}, {{ address.province }} {{ address.zip }}<br>
                        {{ address.country }}
                      </p>
                    </div>
                    <div class="address-actions">
                      <a href="/account/addresses/{{ address.id }}" class="btn btn-secondary">Edit</a>
                      {% unless address == customer.default_address %}
                        <form method="post" action="/account/addresses/{{ address.id }}" style="display: inline;">
                          <input type="hidden" name="_method" value="delete">
                          <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this address?')">Delete</button>
                        </form>
                      {% endunless %}
                    </div>
                  </div>
                {% endfor %}
              {% else %}
                <div class="empty-addresses">
                  <p>You haven't added any addresses yet.</p>
                </div>
              {% endif %}
            </div>
            <a href="/account/addresses/new" class="btn btn-primary address-add-btn">Add New Address</a>
          </div>

          <!-- Wishlist Section -->
          <div class="account-section" id="wishlist-section">
            <h2 class="section-title">My Wishlist</h2>
            <div class="wishlist-preview">
              <p>You have 3 items in your wishlist</p>
              <a href="/pages/wishlist" class="btn btn-primary wishlist-view-btn">View Wishlist</a>
            </div>
          </div>

          <!-- Settings Section -->
          <div class="account-section" id="settings-section">
            <h2 class="section-title">Account Settings</h2>
            {% form 'customer' %}
              {% if form.errors %}
                <div class="form-errors">
                  <h4>Please correct the following errors:</h4>
                  <ul>
                    {% for field in form.errors %}
                      <li>{{ field | capitalize }} {{ form.errors.messages[field] }}</li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}

              {% if form.posted_successfully? %}
                <div class="form-success">
                  <p>Your settings have been updated successfully!</p>
                </div>
              {% endif %}

              <div class="settings-form">
                <div class="form-group">
                  <label for="customer_accepts_marketing">Email Marketing</label>
                  <input
                    type="checkbox"
                    id="customer_accepts_marketing"
                    name="customer[accepts_marketing]"
                    value="1"
                    {% if customer.accepts_marketing %}checked{% endif %}>
                </div>
                <button type="submit" class="btn btn-primary settings-save-btn">Save Settings</button>
              </div>
            {% endform %}
          </div>
        </main>
      </div>
    </div>
  </div>
</div>
{% endunless %}

<style>
  /* Account Page Styles */
  .account-page {
    min-height: 100vh;
    padding: 4rem 0;
  }

  /* Login Required Styles */
  .account-login-required {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4rem 0;
  }

  .login-prompt {
    text-align: center;
    background: var(--white);
    padding: 4rem;
    border-radius: 1.2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    max-width: 50rem;
  }

  .login-prompt h1 {
    font-size: 3.6rem;
    margin-bottom: 2rem;
    color: var(--gray-700);
    background: linear-gradient(135deg, #dc2626, #000000);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .login-prompt p {
    font-size: 1.6rem;
    color: var(--gray-500);
    margin-bottom: 3rem;
  }

  .login-prompt .btn {
    margin: 0 1rem;
  }

  /* Form Messages */
  .form-errors {
    background: #fef2f2;
    border: 2px solid #fecaca;
    border-radius: 1.2rem;
    padding: 2rem;
    margin-bottom: 3rem;
    color: #dc2626;
  }

  .form-errors h4 {
    margin: 0 0 1rem 0;
    font-size: 1.6rem;
    font-weight: 600;
    color: #dc2626;
  }

  .form-errors ul {
    margin: 0;
    padding-left: 2rem;
    list-style-type: disc;
  }

  .form-errors li {
    margin-bottom: 0.5rem;
    font-size: 1.4rem;
  }

  .form-success {
    background: #f0fdf4;
    border: 2px solid #bbf7d0;
    border-radius: 1.2rem;
    padding: 2rem;
    margin-bottom: 3rem;
    color: #16a34a;
  }

  .form-success p {
    margin: 0;
    font-size: 1.4rem;
    font-weight: 600;
  }

  /* Empty States */
  .empty-orders,
  .empty-addresses {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--gray-100);
    border-radius: 1.2rem;
    border: 1px solid var(--gray-200);
  }

  .empty-orders p,
  .empty-addresses p {
    font-size: 1.6rem;
    color: var(--gray-500);
    margin-bottom: 2rem;
  }

  .page-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .page-title {
    font-size: 4.8rem;
    margin-bottom: 1.6rem;
    color: var(--gray-700);
    background: linear-gradient(135deg, #dc2626, #000000);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .page-description {
    font-size: 1.6rem;
    color: var(--gray-500);
  }

  .account-content {
    max-width: 120rem;
    margin: 0 auto;
  }

  .account-layout {
    display: grid;
    grid-template-columns: 25rem 1fr;
    gap: 4rem;
  }

  .account-sidebar {
    background: var(--white);
    border-radius: 1.2rem;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    height: fit-content;
    position: sticky;
    top: 2rem;
  }

  .account-nav {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }

  .account-nav-link {
    padding: 1.2rem 1.6rem;
    color: var(--gray-500);
    text-decoration: none;
    border-radius: 0.8rem;
    transition: all 0.3s ease;
    font-size: 1.4rem;
    font-weight: 500;
  }

  .account-nav-link:hover,
  .account-nav-link.active {
    background: linear-gradient(135deg, #dc2626, #000000);
    color: var(--white);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
  }

  .account-main {
    background: var(--white);
    border-radius: 1.2rem;
    padding: 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .account-section {
    display: none;
  }

  .account-section.active {
    display: block;
  }

  .section-title {
    font-size: 2.4rem;
    margin-bottom: 3rem;
    color: var(--gray-700);
    background: linear-gradient(135deg, #dc2626, #000000);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .profile-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(30rem, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }

  .form-group label {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--gray-700);
  }

  .form-group input {
    padding: 1.2rem 1.6rem;
    border: 2px solid var(--gray-200);
    border-radius: 0.8rem;
    font-size: 1.4rem;
    transition: border-color 0.3s ease;
  }

  .form-group input:focus {
    outline: none;
    border-color: var(--primary-light);
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
  }

  .orders-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .order-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 2rem;
    background: var(--gray-100);
    border-radius: 1.2rem;
    gap: 2rem;
    border: 1px solid var(--gray-200);
    transition: all 0.3s ease;
  }

  .order-item:hover {
    border-color: var(--primary-light);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
  }

  .order-info {
    flex: 1;
  }

  .order-number {
    font-size: 1.6rem;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.4rem;
  }

  .order-date {
    font-size: 1.4rem;
    color: var(--gray-500);
    margin-bottom: 0.4rem;
  }

  .order-status {
    font-size: 1.2rem;
    color: var(--primary-light);
    font-weight: 600;
  }

  .order-total {
    font-size: 1.8rem;
    font-weight: 600;
    color: var(--gray-700);
  }

  .addresses-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .address-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 2rem;
    background: var(--gray-100);
    border-radius: 1.2rem;
    gap: 2rem;
    border: 1px solid var(--gray-200);
    transition: all 0.3s ease;
  }

  .address-item:hover {
    border-color: var(--primary-light);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
  }

  .address-info h3 {
    font-size: 1.6rem;
    margin-bottom: 1rem;
    color: var(--gray-700);
  }

  .address-info p {
    font-size: 1.4rem;
    color: var(--gray-500);
    line-height: 1.6;
  }

  .address-actions {
    display: flex;
    gap: 1rem;
  }

  .wishlist-preview {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--gray-100);
    border-radius: 1.2rem;
    border: 1px solid var(--gray-200);
    transition: all 0.3s ease;
  }

  .wishlist-preview:hover {
    border-color: var(--primary-light);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
  }

  .wishlist-preview p {
    font-size: 1.6rem;
    color: var(--gray-500);
    margin-bottom: 2rem;
  }

  .settings-form {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    max-width: 50rem;
  }

  .settings-form .form-group {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }

  .settings-form input[type="checkbox"] {
    width: 2rem;
    height: 2rem;
  }

  /* Account Page Button Styles */
  .profile-update-btn,
  .address-add-btn,
  .wishlist-view-btn,
  .settings-save-btn {
    background: linear-gradient(135deg, #dc2626, #000000);
    color: var(--white);
    border: none;
    padding: 1.2rem 2.4rem;
    border-radius: 0.8rem;
    font-size: 1.4rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
  }

  .profile-update-btn:hover,
  .address-add-btn:hover,
  .wishlist-view-btn:hover,
  .settings-save-btn:hover {
    background: linear-gradient(135deg, #b91c1c, #000000);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3);
  }

  .profile-update-btn:active,
  .address-add-btn:active,
  .wishlist-view-btn:active,
  .settings-save-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .account-layout {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .account-sidebar {
      position: static;
      order: 2;
    }

    .account-main {
      order: 1;
    }

    .profile-form {
      grid-template-columns: 1fr;
    }

    .order-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .address-item {
      flex-direction: column;
      align-items: flex-start;
    }
  }

</style>

<script>
  // Account page functionality
  document.addEventListener('DOMContentLoaded', function() {
  const navLinks = document.querySelectorAll('.account-nav-link');
  const sections = document.querySelectorAll('.account-section');
  
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Remove active class from all links and sections
      navLinks.forEach(l => l.classList.remove('active'));
      sections.forEach(s => s.classList.remove('active'));
      
      // Add active class to clicked link
      this.classList.add('active');
      
      // Show corresponding section
      const sectionId = this.dataset.section + '-section';
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.add('active');
      }
    });
  });
  });
</script>